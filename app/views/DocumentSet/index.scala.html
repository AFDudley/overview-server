@(
  user: models.orm.User,
  documentSets: Seq[models.orm.DocumentSet],
  form: controllers.forms.DocumentSetForm.FormType
)(implicit lang: Lang, flash: Flash)

@import views.html.helper.EnumToString

@javascripts = {
  <!-- See issue #33 -->
  <script src="@routes.Assets.at("javascripts/vendor-coffee/base64.js")"></script>
  <script src="@routes.Assets.at("javascripts/dcimport/templates/login.js")"></script>
  <script src="@routes.Assets.at("javascripts/dcimport/templates/_project.js")"></script>
  <script src="@routes.Assets.at("javascripts/dcimport/login.js")"></script>
  <script src="@routes.Assets.at("javascripts/dcimport/import-project.js")"></script>
  <script type="text/javascript">
    var node = $('#documentcloud-import .with-login')[0];
    dcimport.import_project_with_login(node);

    var $manual_root = $('#documentcloud-import .manual');
    $manual_root.find('a:eq(0)').on('click', function(e) {
      e.preventDefault();
      $manual_root.find('form').toggle();
    });

    var $sample_root = $('#documentcloud-import .sample');
    $sample_root.find('a:eq(0)').on('click', function(e) {
      e.preventDefault();
      $sample_root.find('ul').toggle();
    });
  </script>
}

@jsMessageKeys = @{Seq(
  "views.DocumentSet._documentSet.jobs_to_process",
  "views.DocumentSet._documentSet.action_import",
  "views.DocumentSet._documentSet.document_count",
  "views.DocumentSet._dcimport.legend",
  "views.DocumentSet._dcimport.error",
  "views.DocumentSet._dcimport.labels.email",
  "views.DocumentSet._dcimport.labels.password",
  "views.DocumentSet._dcimport.placeholders.email",
  "views.DocumentSet._dcimport.submit",
  "views.DocumentSet._dcimport.explanation"
)}

@sampleForm(title: String, query: String, description: String) = {
  <form method="post" action="@routes.DocumentSetController.create" class="form-inline">
    <input type="hidden" name="title" value="@title"/>
    <input type="hidden" name="query" value="@query"/>
    <button class="btn"><i class="icon-download"></i> Import</button>
  </form>
  <h3>@title</h3>
  <p class="status">@description</p>
}

@defining(scopedMessages("views.DocumentSet.index")) { m =>
  @main(optionalUser=Some(user), title=m("title"), bodyClass="document-set-index", h1=m("h1"), javascripts=javascripts, jsMessageKeys=jsMessageKeys) {
    @if(documentSets) {
      <ul class="unstyled document-sets">
        @documentSets.map(_documentSet(_))
      </ul>
    } else {
      <p class="no-document-sets">@m("no_document_sets")</p>
    }

    <div id="documentcloud-import" class="well">
      <h2>@m("import_from_documentcloud")</h2>

      <hr />

      <div class="with-login">
        <p><a href="#">@m("import_from_documentcloud_account")</a></p>
      </div>

      <hr />

      <div class="sample">
        <p><a href="#">@m("import_sample_document_set")</a></p>

        <ul class="unstyled projects">
          <li>@sampleForm("Whitehouse emails prior to BP oil spill", "projectid:5359", "About 600 documents")</li>
          <li>@sampleForm("Homicides in DC", "group:homicide-watch", "Court documents: about 350 documents")</li>
          <li>@sampleForm("WikiLeaks spy files", "projectid:6560", "Brochures from surveillance equipment manufacturers: about 300 documents")</li>
        </ul>
      </div>

      <hr />

      <div class="manual">
        <p><a href="#">@m("import_from_documentcloud_manual")</a></p>

        <form method="post" action="@routes.DocumentSetController.create" class="form-horizontal" style="@(if(form.hasErrors) "" else "display:none;")">
          @if(form.hasGlobalErrors) {
            <div class="control-group error">
              <ul class="unstyled controls">
                @form.globalErrors.map { error =>
                  <li class="help-block error">@t(error.message, error.args: _*)</li>
                }
              </ul>
            </div>
          }

          @for(fieldName <- Seq("title", "query")) {
            @form.forField(fieldName) { field =>
              <fieldset class="control-group@(if(field.errors.isEmpty) "" else " error")">
                <label class="control-label" for="document-set-@field.name">@m(field.name + "_label")</label>
                <div class="controls">
                  <input id="document-set-@field.name" name="@field.name" type="text" class="input-large" required="required" placeholder="@m(field.name + "_placeholder")" />
                  @defining(m(field.name + "_help")) { inlineHelp =>
                    @if(!".".equals(inlineHelp)) {
                      <span class="help-inline">@inlineHelp</span>
                    }
                  }
                  @field.errors.map { error =>
                    <span class="help-inline">@t(error.message, error.args: _*)</span>
                  }
                </div>
              </fieldset>
            }
          }

          <fieldset class="form-actions">
            <input type="submit" class="btn btn-primary" value="@m("import_from_documentcloud_manual_submit")" />
          </fieldset>
        </form>
      </div>
    </div>
  }
}
