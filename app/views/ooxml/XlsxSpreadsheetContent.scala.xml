@(spreadsheet: models.export.rows.Rows
)<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<worksheet
    xmlns="http://purl.oclc.org/ooxml/spreadsheetml/main"
    xmlns:r="http://purl.oclc.org/ooxml/officeDocument/relationships">
  @ST_XstringEscape(text: String) = @{
    val s1 = """_x[0-9a-fA-F]{4}_""".r.replaceAllIn(text, (m => s"_x005F${m.matched}"))
    org.owasp.encoder.Encode.forXml(s1).take(32767)
  }

  <sheetData>
    <row>
      @for(heading: String <- spreadsheet.headers) {
        @Xml(ST_XstringEscape(heading).toString)
      }
    </row>
    @for(row: Iterable[Any] <- spreadsheet.rows) {
      <row>
        @for(value: Any <- row; str: String = value.toString) {
          @{val str = value.toString}
          @if(str.isEmpty) {
            <c t="inlineStr"/>
          } else {
            <c t="inlineStr"><is><t>@Xml(ST_XstringEscape(str))</t></is></c>
          }
        }
      </row>
    }
  </sheetData>
</worksheet>
