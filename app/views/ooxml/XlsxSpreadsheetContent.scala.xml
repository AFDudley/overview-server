@(spreadsheet: models.export.rows.Rows
)<?xml version="1.0" encoding="utf-8"?>
<worksheet
    xmlns="http://purl.oclc.org/ooxml/spreadsheetml/main"
    xmlns:r="http://purl.oclc.org/ooxml/officeDocument/relationships">
  @ST_XstringEscape(text: String) = @{
    val s1 = """_x[0-9a-fA-F]{4}_""".r.replaceAllIn(text, (m => s"_x005F${m.matched}"))
    """[\x00-\x08\x0b\x0c\x0e-\x1f\x7f-\x84\x86-\x9f]""".r.replaceAllIn(s1, (m => "_x%04X_".format(m.matched.codePointAt(0))))
  }

  @inlineStringCell(text: String) = @{
    if (text.length == 0) {
      <c t="inlineStr"/>
    } else {
      <c t="inlineStr"><is><t>{ST_XstringEscape(text).take(32767)}</t></is></c>
    }
  }

  <sheetData>
    <row>
      @for(heading: String <- spreadsheet.headers) {
        @Xml(inlineStringCell(heading).toString)
      }
    </row>
    @for(row: Iterable[Any] <- spreadsheet.rows) {
      <row>
        @for(value: Any <- row) {
          @Xml(inlineStringCell(value.toString).toString)
        }
      </row>
    }
  </sheetData>
</worksheet>
